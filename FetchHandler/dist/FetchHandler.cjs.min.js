'use strict';Object.defineProperty(exports,"__esModule",{value:!0});function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}var fetchResponseHandlerInstance=function a(b){var c=function(){return new Promise(function(c,d){a.defaults.AuthManagerBridge.refreshToken().then(function(){b.refresh(),fetch(b.request).then(function(a){c(a)}).catch(function(a){d(a)})}).catch(function(){fetchResponseHandlerInstance.defaults.AuthManagerBridge.logout()})})},d=function(a){return new Promise(function(b,d){401==a.status?(console.log("token is refreshed in"+new Date),c().then(function(c){a=c,b(a)}).catch(function(a){d(a)})):b(a)})};return function(a){return new Promise(function(b,c){var e=d(a);Promise.all([e]).then(function(a){var d=_slicedToArray(a,1),e=d[0];if(e.ok){var f=e.headers.get("content-type");f&&-1!==f.indexOf("application/json")?b(e.json()):f&&-1!==f.indexOf("image/")?e.arrayBuffer().then(function(a){var c=btoa(new Uint8Array(a).reduce(function(a,b){return a+String.fromCharCode(b)},""));b("data:".concat(f,";base64,")+c)}):b({})}else return 502==e.status?c({errorMessage:"\u062E\u0637\u0627\u06CC 502  \u060C \u0633\u0631\u0648\u0631 \u06CC\u0627 \u062F\u0631 \u062D\u0627\u0644 \u0628\u0647 \u0631\u0648\u0632 \u0631\u0633\u0627\u0646\u06CC \u0627\u0633\u062A \u06CC\u0627 \u062F\u0686\u0627\u0631 \u0627\u0634\u06A9\u0627\u0644 \u0634\u062F\u0647 \u0627\u0633\u062A"}):e.json().then(function(a){c(a)})})})}};fetchResponseHandlerInstance.defaults={AuthManagerBridge:void 0};function fetchErrorHandler(a){var b=window.showMessage?window.showMessage:null;if(!b)var b=function(a){window?alert(a):console.log(a)};if(!a.errorMessage)a.message&&b(a.message,"error",a);else if(b(a.errorMessage,"error",a),a.errors)for(var c in a.errors)b(a.errors[c])}exports.fetchResponseHandler=fetchResponseHandlerInstance,exports.fetchErrorHandler=fetchErrorHandler;
